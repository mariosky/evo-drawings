<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html lang="en" xmlns="http://www.w3.org/1999/html"> <!--<![endif]-->
<head>

<!-- Basic Page Needs
================================================== -->
<meta charset="utf-8">
<title>EvoSpace interactive</title>
<meta name="description" content="">
<meta name="author" content="">

<!-- Mobile Specific Metas
================================================== -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<!-- CSS
================================================== -->

<link href="/static/static/css/bootstrap.min.css" rel="stylesheet">
<link href="/static/static/css/jumbotron.css" rel="stylesheet">
<!--<link rel="stylesheet" href="https://s3.amazonaws.com/evospace/prototype/stylesheets/base.css">-->
<!--<link rel="stylesheet" href="https://s3.amazonaws.com/evospace/prototype/stylesheets/skeleton.css">-->
<link rel="stylesheet" href="https://s3.amazonaws.com/evospace/prototype/stylesheets/layout.css">
<link rel="Stylesheet" href="https://s3.amazonaws.com/evospace/prototype/stylesheets/wHumanMsg.css" />
<link rel="stylesheet" href="/static/static/css/prototype.css">
<link href="/static/static/css/mycss.css" rel="stylesheet">
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>


<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<!-- Favicons
    ================================================== -->
<link rel="shortcut icon" href="https://s3.amazonaws.com/evospace/prototype/images/favicon.ico">
<link rel="apple-touch-icon" href="https://s3.amazonaws.com/evospace/prototype/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://s3.amazonaws.com/evospace/prototype/images/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114" href="https://s3.amazonaws.com/evospace/prototype/images/apple-touch-icon-114x114.png">

<!-- ================ -->
<!-- attach js files -->
<!-- ================
<script type="text/javascript" src="https://s3.amazonaws.com/evospace/prototype/js/jquery-1.5.1.min.js"></script>-->

<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<!--<script src="/static/static/js/jquery.js"></script>-->
<script src="static/static/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://s3.amazonaws.com/evospace/prototype/js/designesia.js"></script>
<script type="text/javascript" src="https://s3.amazonaws.com/evospace/prototype/js/easing.js"></script>
<script type="text/javascript" src="https://s3.amazonaws.com/evospace/prototype/js/jquery.ui.totop.js"></script>
<script type="text/javascript" src="https://s3.amazonaws.com/evospace/prototype/js/jquery.ui.totop.setting.js"></script>
<script type="text/javascript" src="https://s3.amazonaws.com/evospace/prototype/js/jquery.prettyPhoto.js"></script>
<script type="text/javascript" src="https://s3.amazonaws.com/evospace/prototype/js/jquery.prettyPhoto.setting.js"></script>
<script type="text/javascript" src="https://s3.amazonaws.com/evospace/prototype/js/wHumanMsg.js"></script>


<link href="/static/static/css/star-rating.css" media="all" rel="stylesheet" type="text/css"/>
<script src="/static/static/js/star-rating.js" type="text/javascript"></script>




<!-- ================
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.23/jquery-ui.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
================ -->
<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.0/themes/base/jquery-ui.css" />

<script src="http://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>

<script src="https://s3.amazonaws.com/evospace/prototype/js/processing-1.3.6.min.js" type="text/javascript"></script>
<script type="text/javascript" src="https://s3.amazonaws.com/evospace/prototype/js/jquery.youtubepopup.min.js"></script>

<!-- Scripts
    ================================================== -->

<style>
    #feedback { font-size: 1.4em; }
    #selectable { list-style-type: none; margin: 0; padding: 0; width: 90%; }
    #selectable li { margin: 3px; padding: 0.4em; font-size: 1em; height: 27px; padding-left:28px ; }
    #selectable a { text-decoration: none; }

    .frame img { width: 100%; }
    .frame {height: 30px; overflow: hidden; margin-bottom: 4px;}
     li.folder{ background: url("http://evospace.org/images/folder.png") no-repeat scroll 5px 5px white;   }
</style>


<script>

$(document).ready(function () {
    var hm = $("body").wHumanMsg();

    $( document ).tooltip();

    $( "#tabs" ).tabs({collapsible: true});
    //$( "#selectable" ).selectable();


    var get_collections = function(){
        var user=$("#username").val();
        alert(user);
        $.ajax({
            type: "GET",
            url: "/get_user_collections/"+user+"/",
            dataType: "json",
            success: function(data) {

                $("#selectable").html("");
                //
                // Esto es un foreach
                //
                for (var i=0; i<data.collections.length; i++){
                    $('<a />',
                            {
                                //"class":"glyphicon glyphicon-folder-open",
                                href:"/get_collection/"+user+"/" + data.collections[i].id

                             }
                     ).append(

                            $('<li />' ,
                                    {   "class":"ui-widget-content folder",
                                        //"class":"glyphicon glyphicon-folder-open",
                                        text:  "   "+data.collections[i].name.substr(0,40)



                                    })


                    ).appendTo("#selectable");

                }

            }
        });

    };


 //   $(function() {
 //       $( "#selectable" ).selectable();
 //   });

    $.ajaxSetup({
         beforeSend: function(xhr, settings) {
             function getCookie(name) {
                 var cookieValue = null;
                 if (document.cookie && document.cookie != '') {
                     var cookies = document.cookie.split(';');
                     for (var i = 0; i < cookies.length; i++) {
                         var cookie = jQuery.trim(cookies[i]);
                         // Does this cookie string begin with the name we want?
                     if (cookie.substring(0, name.length + 1) == (name + '=')) {
                         cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                         break;
                     }
                 }
             }
             return cookieValue;
             }
             if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                 // Only send the token to relative URLs i.e. locally.
                 xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
             }
         }
    });

    var $dialog = $('<div></div>')
            .dialog({
                autoOpen: false,
                title: 'Liked by',
                modal:true,
                                show:'fadeIn', //crh
                                hide:'fadeOut' //crh
            });

     var $dialog2 = $('#box2')
             .dialog({
                 autoOpen: false,
                 title: 'Collection',
                 modal:true,
                 show:'fadeIn', //crh
                 hide:'fadeOut',
                 buttons: { "Add": function(e) {
                            e.preventDefault();

                            $.ajaxSetup({
                                beforeSend: function(xhr, settings) {
                                function getCookie(name) {
                                    var cookieValue = null;
                                    if (document.cookie && document.cookie != '') {
                                        var cookies = document.cookie.split(';');
                                        for (var i = 0; i < cookies.length; i++) {
                                            var cookie = jQuery.trim(cookies[i]);
                                            // Does this cookie string begin with the name we want?
                                            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                                break;
                                            }
                                        }
                                    }
                                    return cookieValue;
                                }
                                if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                                    // Only send the token to relative URLs i.e. locally.
                                    xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                                }
                              }
                             });


                            var dataString = $("#add_collec").serialize();
                            console.log('datastring '+dataString);
                            //Tomar el usuario del HTML y hacer la cadena del URL
                            var col_name = $("#col_name").val();
                            var col_description = $("#col_description").val();
                            var col_option = $("#col_option").val();
                            var username =$("#username").val();
                            $.ajax({
                                type: "POST",
                                url: "/add_collection/"+username+"/",
                                data: JSON.stringify({"name":col_name, "description":col_description, "option":col_option}),
                                dataType: "json",
                                contentType:"application/json",
                                success: function(data) {

                                    get_collections();
                                    hm.wHumanMsg(data.message);
                                    //console.log('message :'+data.message);

                                }


                            });


                            $(this).dialog("close");
                          },
                           "Cancel": function() {
                           $(this).dialog("close");
                          }
                        }
             });

    var $dialog3 = $('#box3')
            .dialog({
                autoOpen: false,
                title: 'Add to',
                modal:true,
                show:'fadeIn', //crh
                hide:'fadeOut',
                buttons: { "Add to Collection": function() {

                    //var dataString = $("#add_ind_col").serialize();
                    var individual = $("#individual_id").val()
                    var user_collection = $("#uc").val()
                    //Tomar el usuario del HTML y hacer la cadena del URL
                    var username =$("#username").val();
                    //alert(username);
                    var URL="/add_ind_to_col/"+username+"/";
                    //console.log('datastring '+dataString);
                    $.ajax({
                        type: "POST",
                        url: URL,
                        data: JSON.stringify({"id":individual, "userCollection":user_collection}),
                        dataType: "json",
                        contentType:"application/json",
                        success: function(data) {
                            //alert(data.name);

                            //console.log('hola '+data.visibility);
                            hm.wHumanMsg(data.message);

                            //console.log('message :'+data.message);

                        }


                    });

                    $(this).dialog("close");
                },
                    "Cancel": function() {
                        $(this).dialog("close");
                    }
                }
            });





    $('.grid-item.slidedown').hover(function(){
        $(".cover", this).stop().animate({top:'5px', left:'5px'},{queue:false,duration:300});
    }, function() {
        $(".cover", this).stop().animate({top:'-560px',left:'5px'},{queue:false,duration:300});
    });

    $('.grid-item.slideup').hover(function(){
        $(".cover", this).stop().animate({top:'422px', left:'5px'},{queue:false,duration:300});
    }, function() {
        $(".cover", this).stop().animate({top:'480px',left:'5px'},{queue:false,duration:300});
    });

    $("canvas").click(function () {
        $(this).toggleClass("ilike");

    });



    $(".fitness").click(function ()
    {

        var slot_index = $(this)[0].parentElement.previousSibling.previousSibling.id.substr(4);

        var details ="";
        for (var index in sample.sample[slot_index].fitness){
            if (index != "DefaultContext"){
            var id = index.split(":")[0];

            details+= "<img src='http://graph.facebook.com/"+id+"/picture?type=square'/>";
            //details+= "<fb:profile-pic size='square' facebook-logo='true' uid='"+id+"'/>";
            }
         }
        $dialog.html(details);
        $dialog.dialog('open');
        return false;

    });

    //crh
    $(".addto").click(function ()

    {
        var slot_index = $(this)[0].parentElement.previousSibling.previousSibling.id.substr(4);

        var dataSample =sample.sample[slot_index].id;

        var inp ='<input type="text'+ '" id="individual_id" name="individual" value="'+dataSample+'" readonly>';


        $("#col_ind").html(inp);


        $(function(){
            //Tomar el usuario desde un campo del HTML
            var username =$("#username").val();
            $.ajax({
                type: "GET",
                url: "/get_user_collections/"+username+"/",
                dataType: "json",
                success: function(data) {
                    var options = '';
                    for (var i=0; i<data.collections.length; i++){
                        options += '<option value="' + data.collections[i].id + '">' + data.collections[i].name + '</option>';
                    }
                    $("#uc").html(options);


                }
            });

        })

        //$dialog.html(details);
        $dialog3.dialog('open');
        return false;

    });


    $("#get_more").click(function () {
        if (sample )
        {
            var individuals = $(".ilike").length;
            sample.individuals_with_like=[];

            var value1= $("#input-21e").val();
            var value2= $("#input-22e").val()

            $("canvas").each(
                    function(i, element){
                        var slot_index = element.id.substr(4);
                        var timestamp = Date.now()



                            var username =$("#username").val();


                        //if ( $(this).hasClass("ilike"))
                        if ( $(this).hasClass("ilike"))
                        {
                            if (value1){
                                sample.sample[slot_index].fitness[username+":"+timestamp] = value1;
                                $(this).toggleClass("ilike");
                                sample.individuals_with_like.push(sample.sample[slot_index].id);
                                alert(value1)

                            }

                            if (value2){
                                sample.sample[slot_index].fitness[username+":"+timestamp] = value2;
                                $(this).toggleClass("ilike");
                                sample.individuals_with_like.push(sample.sample[slot_index].id);
                                alert(value2)

                            }
                            //sample.sample[slot_index].fitness[username+":"+timestamp] = 1;
                            
                        }

                        sample.sample[slot_index].views += 1;
                        $("#input-21e").val(0);


                    }

            );


            //Put them back
            $("#get_more")[0].disabled = true;
            $("#get_more")[0].innerHTML = "Wait..."
            $.ajax(
                    {
                        url: '/EvoSpace',
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify({"jsonrpc": "2.0", "method": "putSample", "params": [sample], "id": 1}),

                        //data: {"jsonrpc": "2.0", "method": "putSample", "params": [sample], "id": 1},
                        dataType: "json",
                        success: function(data, textStatus, jqXHR) {
                            //  alert(sample.sample[0].chromosome);
                        },
                        error: function(jqXHR, textStatus, errorThrown)  {
                            alert ("Error: putSample" + textStatus+" "+errorThrown+" "+jqXHR.responseText);}

                    });

            hm.wHumanMsg('Likes:'+ individuals + ', new paintings received',{color: 'yellow',  displayLength: 400});

            //Get More!
        }

        dataRequest();


    });


    $('.rating').on('rating.change', function(event, value, caption) {
       //alert("evento"); 
       //alert($(this));
       //alert($(this).parent().parent().parent().parent().prev()[0].id);

         var inputbox = $(this)[0].id; 
      if (sample){
         //alert(value);
          sample.individuals_with_like=[];

          var slot = $(this).parent().parent().parent().parent().prev()[0].id;
          
          slot = "#" + slot;
          //alert(slot); 

            $(slot).each(
                    function(i, element){
                        var slot_index = element.id.substr(4);
                        var timestamp = Date.now()



                        var username =$("#username").val();


                        //if ( $(this).hasClass("ilike"))
                        if ( value )
                        {
                            sample.sample[slot_index].fitness[username+":"+timestamp] = value;
                            sample.individuals_with_like.push(sample.sample[slot_index].id);
                            //alert(value);
         
                            //sample.sample[slot_index].fitness[username+":"+timestamp] = 1;
                            
                        }
                        sample.sample[slot_index].views += 1;
                        
                        //$(inputbox).value() = 0;
                
                    }

            );
             
            
            //alert(sample);    
            $.ajax(
                    {
                        url: '/EvoSpace',
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify({"jsonrpc": "2.0", "method": "putSample", "params": [sample], "id": 1}),

                        //data: {"jsonrpc": "2.0", "method": "putSample", "params": [sample], "id": 1},
                        dataType: "json",
                    
                        success: function(data, textStatus, jqXHR) {

                            //alert(sample.sample[0].chromosome);
                        },
                        error: function(jqXHR, textStatus, errorThrown)  {
                            //alert("jejejjej error");
                            alert ("Error: putSample" + textStatus+" "+errorThrown+" "+jqXHR.responseText);}

                    });

            hm.wHumanMsg('Likes:'+ ', new paintings received',{color: 'yellow',  displayLength: 400});

      }
        
        var delay=2000;//1 seconds
             setTimeout(function(){
               
                inputbox = "#" + inputbox;
                //alert(inputbox);

                

                $(inputbox).rating('reset');
                //alert("delay");    

             //your code to be executed after 1 seconds
            },delay); 

        respawn();     
        var container = $(this).parent().parent().parent().parent().prev()[0].id;    
        dataRequestPaints(container);
        
    
    });

    // $('#input-22e').on('rating.change', function(event, value, caption) {
        
    //   if (sample){
    //      //alert(value);
    //      sample.individuals_with_like=[];
    //      alert(event);
    //      alert($(this));

    //         $("#slot0").each(
    //                 function(i, element){
    //                     var slot_index = element.id.substr(4);
    //                     var timestamp = Date.now()



    //                     var username =$("#username").val();


    //                     //if ( $(this).hasClass("ilike"))
    //                     if ( value )
    //                     {
    //                         sample.sample[slot_index].fitness[username+":"+timestamp] = value;
    //                         sample.individuals_with_like.push(sample.sample[slot_index].id);
    //                         alert(value);
         
    //                         //sample.sample[slot_index].fitness[username+":"+timestamp] = 1;
                            
    //                     }
                
    //                 }

    //         );

    //         alert(sample);    
    //         $.ajax(
    //                 {
    //                     url: '/EvoSpace',
    //                     type: "POST",
    //                     contentType: "application/json",
    //                     data: JSON.stringify({"jsonrpc": "2.0", "method": "putSample", "params": [sample], "id": 1}),

    //                     //data: {"jsonrpc": "2.0", "method": "putSample", "params": [sample], "id": 1},
    //                     dataType: "json",
    //                     success: function(data, textStatus, jqXHR) {
    //                         //  alert(sample.sample[0].chromosome);
    //                     },
    //                     error: function(jqXHR, textStatus, errorThrown)  {
    //                         alert ("Error: putSample" + textStatus+" "+errorThrown+" "+jqXHR.responseText);}

    //                 });

    //         hm.wHumanMsg('Likes:'+ ', new paintings received',{color: 'yellow',  displayLength: 400});

    //   }
    //     var container = "#slot1"    
    //     dataRequestPaints(container);
    
    // });

    $("#evolve").click(function () {

        //Put them back
        $.ajax(
                {
                    url: '/EvoSpace',
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({"jsonrpc": "2.0", "method": "evolve", "params": [16], "id": 1 }),
                    dataType: "json",
                    success: function(data, textStatus, jqXHR) {


                        hm.wHumanMsg('Success in evolution of population',{color: 'green',  displayLength: 400});

                    },

                    error: function(jqXHR, textStatus, errorThrown)  {
                        alert ("Error:" + textStatus+" "+errorThrown+" "+jqXHR.responseText);}

                });

    });

    $("#respawn").click(function () {

        //Put them back
        $.ajax(
                {
                    url: '/EvoSpace',
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({"jsonrpc": "2.0", "method": "respawn", "params": [2], "id": 1 }),
                    dataType: "json",
                    success: function(data, textStatus, jqXHR) {


                        hm.wHumanMsg('Samples respawned',{color: 'red',  displayLength: 400});

                    },

                    error: function(jqXHR, textStatus, errorThrown)  {
                        alert ("Error:" + textStatus+" "+errorThrown+" "+jqXHR.responseText);}

                });

    });

    function respawn(){
         //Put them back
        $.ajax(
                {
                    url: '/EvoSpace',
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({"jsonrpc": "2.0", "method": "respawn", "params": [2], "id": 1 }),
                    dataType: "json",
                    success: function(data, textStatus, jqXHR) {


                        hm.wHumanMsg('Samples respawned',{color: 'red',  displayLength: 400});

                    },

                    error: function(jqXHR, textStatus, errorThrown)  {
                        alert ("Error:" + textStatus+" "+errorThrown+" "+jqXHR.responseText);}

                });

    }



    function dataRequestPaints(container){
        //alert(container);
        $("#check").hide();
        container = "#"+container;
        $.ajax(
                {
                    url: '/EvoSpace',
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({"jsonrpc": "2.0", "method": "getSample", "params": [2], "id": 1 }),
                    dataType: "json",
                    success: function(data, textStatus, jqXHR) {
                        //data = jQuery.parseJSON(data);
                        sample =data.result;
                        //Put them back
                        $("#get_more")[0].disabled = false;
                        $("#get_more")[0].innerHTML = "Get More"


                        if  (data.result == null)
                            alert("No more paintings in evospace: respawn some samples") ;

                        

                        $(container).each(
                                function(i, element){



                                    var bound = false;
                                    var chromosome = sample.sample[i].chromosome;

                                    //pjs

                                    function getPJS() {
                                        var pjs = Processing.getInstanceById(element.id);
                                        if(pjs!=null) {
                                            var chrome = pjs.getChromosome();
                                            //alert(chrome)
                                            chrome.length = 0;
                                            Array.prototype.push.apply(chrome, chromosome);
                                            pjs.setup();//Se resetea el canvas
                                            pjs.draw();
                                            bound = true; }
                                        if(!bound) setTimeout(getPJS, 50);
                                    }

                                    getPJS();




                                    slot_index = element.id.substr(4);

                                    element.nextElementSibling.childNodes[1].setAttribute(
                                        "href","/individual/"+sample.sample[slot_index].id.substr(15));
                                    element.nextElementSibling.childNodes[1].setAttribute(
                                            "target","_blank");
                                    element.nextElementSibling.childNodes[1].textContent = "Details";//"id:" + sample.sample[slot_index].id.substr(15) ;


                                    var suma = 0;
                                    for (var index in sample.sample[slot_index].fitness){
                                        suma+=sample.sample[slot_index].fitness[index];
                                    }

                                    element.nextElementSibling.childNodes[3].textContent= suma +" likes";

                                }
                        );
                    },
                    error: function(jqXHR, textStatus, errorThrown)  {
                        alert("SUper Oso");
                        alert ("Error:" + textStatus+" "+errorThrown+" "+jqXHR.responseText);}
                });
    }

        function dataRequest(){
         $("#get_more").hide();//crh
         $("#check").hide();   
        $.ajax(
                {
                    url: '/EvoSpace',
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({"jsonrpc": "2.0", "method": "getSample", "params": [2], "id": 1 }),
                    dataType: "json",
                    success: function(data, textStatus, jqXHR) {
                        //data = jQuery.parseJSON(data);
                        sample =data.result;
                        //Put them back
                        //$("#get_more")[0].hide();

                        //$("#get_more")[0].innerHTML = "Get More"

                        
                        
                            
                        
                           


                        if  (data.result == null)
                            alert("No more paintings in evospace: respawn some samples") ;


                        $("canvas").each(
                                function(i, element){

                                    var width = $(window).width(), height = $(window).height();
                                    var bound = false;
                                    var chromosome = sample.sample[i].chromosome;
                                    var sizeChange = [550, 450];


                                    if ((width >= 1023) ) {
                                        alert('Remove my nav!');
               
                                        function getPJS() {
                                            var pjs = Processing.getInstanceById(element.id);
                                            if(pjs!=null) {
                                                alert('if');
                                                var chrome = pjs.getChromosome();
                                                var canvasChange = pjs.getSize();
                                                //alert(chrome)
                                                alert(canvasChange);
                                                chrome.length = 0;
                                                canvasChange.length = 0;
                                                Array.prototype.push.apply(chrome, chromosome);
                                                Array.prototype.push.apply(canvasChange, sizeChange);
                                                pjs.setup();//Se resetea el canvas
                                                pjs.draw();
                                                bound = true; }
                                            if(!bound) setTimeout(getPJS, 50);
                                        }

                                        getPJS();

                                    


                                        slot_index = element.id.substr(4);

                                        element.nextElementSibling.childNodes[1].setAttribute(
                                            "href","/individual/"+sample.sample[slot_index].id.substr(15));
                                        element.nextElementSibling.childNodes[1].setAttribute(
                                                "target","_blank");
                                        element.nextElementSibling.childNodes[1].textContent = "Details";//"id:" + sample.sample[slot_index].id.substr(15) ;


                                        var suma = 0;
                                        for (var index in sample.sample[slot_index].fitness){
                                            suma+=sample.sample[slot_index].fitness[index];
                                        }

                                        element.nextElementSibling.childNodes[3].textContent= suma +" likes";

                                        alert('hola');

                                    } else {
                                         alert('Do nothing');
                                         
                                             function getPJS2() {
                                                var pjs = Processing.getInstanceById(element.id);
                                                if(pjs!=null) {
                                                    alert('nada');
                                                    var chrome = pjs.getChromosome();
                                                    
                                                    //alert(chrome)
                                                    //alert(canvasChange);
                                                    chrome.length = 0;
                                                    
                                                    Array.prototype.push.apply(chrome, chromosome);
                                                    Array.prototype.push.apply(canvasChange, sizeChange);
                                                    pjs.setup();//Se resetea el canvas
                                                    pjs.draw();
                                                    bound = true; }
                                                if(!bound) setTimeout(getPJS2, 50);
                                            }

                                            getPJS2();

                                        


                                            slot_index = element.id.substr(4);

                                            element.nextElementSibling.childNodes[1].setAttribute(
                                                "href","/individual/"+sample.sample[slot_index].id.substr(15));
                                            element.nextElementSibling.childNodes[1].setAttribute(
                                                    "target","_blank");
                                            element.nextElementSibling.childNodes[1].textContent = "Details";//"id:" + sample.sample[slot_index].id.substr(15) ;


                                            var suma = 0;
                                            for (var index in sample.sample[slot_index].fitness){
                                                suma+=sample.sample[slot_index].fitness[index];
                                            }

                                            element.nextElementSibling.childNodes[3].textContent= suma +" likes";

                                            $(".thumbnail").css("width", "310");
                                            $(".boxcaption").css("width", "300");
                                    
                                    }
                                    


                                }
                        );
                    },
                    error: function(jqXHR, textStatus, errorThrown)  {
                        alert ("Error:" + textStatus+" "+errorThrown+" "+jqXHR.responseText);}
                });
    }

    //alert("ready");
    //dataRequest();
        //me
        $('#add_collection').click(function(){

             $dialog2.dialog('open');


        });
    dataRequest();
    get_collections();

    $(function () {
        $("a.youtube").YouTubePopup({ autoplay: 1 });
    });

    //setTimeout(dataRequest,5000);

});/**
 * Created by chris on 5/27/14.
 */

  


</script>

</head>
<body>
<div id="fb-root"></div>
<script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=156105524554651";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>








<!-- Primary Page Layout
    =========================  ========================= -->
 <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Shapes App</a>
        </div>
        <div class="navbar-collapse collapse">



        </div><!--/.navbar-collapse -->
      </div>
    </div>



<div class="container">
    <header>
        <div class="row">

        <div class="col-md-6">
            
                <p><h4>Click on the shapes you like, and give the rate you prefer to get more animations!.</h4> </p>
            
        </div>
        <div class="col-md-6">
           
            <!--<h4 class='strapline'> <a href="/"> <strong> Shapes</strong>   </a></h4>-->
            <!--<h5 class='strapline'> Click on the shapes you like, and get more! </h5>-->

        </div>

        <div class="col-sm-4">
            <br/>
            <button class="btn btn-success" id="respawn"> Respawn</button>
            <button class="btn btn-success" id="get_more" > Get More</button> 
             <button visibility="hidden" id="check" type="button" class="btn btn-success" aria-label="Left Align">
                    <span class="glyphicon glyphicon-ok-sign" aria-hidden="true"> liked!</span>
             </button>
            <!-- <button id="check" class="btn" data-toggle="modal" data-target="#myModal"> Let us know you better!!</button> -->


        </div>

        </div>

    <br/>
    </header>   <!-- header  ================ -->


    <div class="container">
      <!-- Example row of columns -->
      <div class="row">
        <div class="col-md-4">
          <h2>Join us!</h2>
            {% if user.is_authenticated %}
                <p> <img src="http://graph.facebook.com/{{user.username}}/picture?type=square"/> {{ user.first_name }}. <a href="/logout">Log out</a> </p>
                <input id="username" type="hidden" value="{{user.username}}"/>
            {% else %}
                <p>new user. Please <a href="facebook/get_login">log in </a> with your facebook account.</p>
               
                <input id="username" type="hidden" value="anonymous"/>
            {% endif %}
            <hr/>
          <h2 id="friends">Friends</h2>
            {% if user.is_authenticated %}
                      <h1>hello</h1>
                    {% for f in friends  %}

                            <div class='col-sm-2'>

                                <a href="/get_collection/{{ f.id }}">
                                <img src="http://graph.facebook.com/{{f.id}}/picture?type=square"
                                 alt="{{ f.name }}" title="{{ f.name }}"/> </a>
                            </div>
                    {% endfor   %}
            {% else %}

                <p><a href="facebook/get_login"> log in </a> to see your friend's collections.</p>
            {% endif %}
          <br/>

          <br/>


          <h2 id="collections">Collections</h2>
          {% if user.is_authenticated %}
            <ol id="selectable" class="glyphicons">


            </ol>
            <button id="add_collection" title="Add Collection"> + </button>

          {% else %}
          <p><a href="facebook/get_login"> log in </a> to see start or see your collections.</p>
          {% endif %}


          <hr/>
          <h2>How to:</h2>
          <p><ul >
                    <li>
                        <a class="youtube" href="http://www.youtube.com/watch?v=2PFA7mSfUdA">Rate individuals</a>
                    </li>

                    <li>
                        <a class="youtube" href="http://www.youtube.com/watch?v=5FwEpV75aTA">See Ancestors</a>
                    </li>

                    <li>
                        <a class="youtube" href="http://www.youtube.com/watch?v=zE_HGPSDA_0">Save to Collections</a>
                    </li>

                </ul>
          </p>
          <hr/>
          <h2>Help us:</h2>
          <p><ul >
                        <li>
                          You can fork code from  <a href="https://github.com/mariosky/evospacei" target="_blank" >Git Hub. </a>
                          But you better wait for the new version. Bugs and issues please also in <a href="https://github.com/mariosky/evospacei/issues" target="_blank">Git Hub. </a>.
                        </li>
                        <li>
                            Our To-Do list, please put feature requests
                            <a href="https://docs.google.com/document/d/1ncV4tehiLQjGMX1-FcCgiEepSsoJ90BSnYli5PN_jdI/edit?usp=sharing " target="_blank">here.</a>
                        </li>

                   </ul>
            </p>


          </div>


    <div class="container">



        <div class='row'>
          <div class='col-md-6'>
            <div class="thumbnail">
           <!--  <canvas id="slot0" data-processing-sources="https://s3.amazonaws.com/evospace/prototype/figs.pde"></canvas> -->
            
            <canvas id="slot0" data-processing-sources="/static/static/js/figs.pde"></canvas>
            <div class="cover boxcaption">
            <a class="paint_name">                </a>
            <!-- <a class="fitness" > </a> -->
            {% if user.is_authenticated %}
                
                <form>
              
                  <input id="input-21e" value="0" type="number" class="rating" min=0 max=5 step=1 data-size="xs" >
                  
              
                </form>
                <button class="addto"> Add to collection</button>
            {% endif %}
            </div>
            </div>

        </div>




        
 
      </br>
           <div class='col-md-6'>
            </br></br></br></br></br></br>
            <div><p> Compatible with latest versions of Chrome and FireFox. IExplorer 10+ only.</p></div>


            <div class="fb-comments" data-href="http://shapes.evospace.org" data-width="470" data-num-posts="10"></div>

        </div>

        </div>

    </div>




       

    </div>


    </div>


</div><!-- container -->


  <div id="box2"><!-- container -->

        <form id="add_collec" enctype="multipart/form-data">
            <fieldset>
                <label for="col_name">Name</label>
                <input type="text" name="name" id="col_name" class="text ui-widget-content ui-corner-all" />
                <label for="col_description">Description</label>
                <input type="text" name="description" id="col_description" placeholder="Optional" value="" class="text ui-widget-content ui-corner-all" />
                <label for="col_option">Visibility</label>
                       <select name="visibility" id="col_option" placeholder="Optional" lass="text ui-widget-content ui-corner-all">
                            <option value="PU">Public</option>
                            <option value="PR">Private</option>
                        </select>
            </fieldset>
            </form>

  </div>

<div id="box3"><!-- container -->

    <form id="add_ind_col" enctype="multipart/form-data">
        <fieldset id="col_ind" >
        </fieldset>

        <fieldset>
            <select id="uc" name="collection"  lass="text ui-widget-content ui-corner-all">

            </select>
        </fieldset>
    </form>

</div>


     <!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">You</h4>
      </div>
      <div class="modal-body">
        <form role="form" method="POST">{%csrf_token%}
            <div class="form-group">
                <label >Check if you like the following!</label>
                <div class="checkbox">
                   <label>
                      <input type="checkbox" name="webDesing"> Do you like Web design?
                   </label>
                    <br/>
                   <label>
                      <input type="checkbox" name="webDevelopment"> Do you like Web development?
                   </label>
                    <br/>
                   <label>
                      <input type="checkbox" name="internet"> Do you like Internet?
                   </label>
                </div>
                <label >Check the education you have!</label>
                <div class="checkbox">
                   <label>
                      <input type="checkbox" name="elementery"> Elementary
                   </label>
                    <br/>
                   <label>
                      <input type="checkbox" name="high_school"> High School
                   </label>
                    <br/>
                   <label>
                      <input type="checkbox" name="bachelor"> Bachelor Degree
                   </label>
                    <br/>
                   <label>
                      <input type="checkbox" name="master"> Master Degree
                   </label>
                    <br/>
                   <label>
                      <input type="checkbox" name="PhD"> PhD Degree
                   </label>
                </div>

            </div>
            <input type="submit"/>
        </form>
      </div>


      <div class="modal-footer">
           {% if user.is_authenticated %}

           {% else %}


           {% endif %}

        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <!--<button type="button submit" class="btn btn-primary">Save changes</button>-->

      </div>
    </div>
  </div>
 </div>





    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!--<script src="static/js/jquery.js"></script>-->

  </body>
</html>
